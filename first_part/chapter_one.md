# HTTP 的简要介绍

- Web 客户端与服务器是如何通信的
- （Web 内容）资源来自何方
- Web 事务是怎样工作的
- HTTP 通信所使用的报文格式
- 底层 tcp 网络传输
- 不同的 HTTP 协议变体
- 因特网上安装的大量 HTTP 架构组件中的一部分

## Web 客户端和服务器

&nbsp;&nbsp;&nbsp;&nbsp;HTTP 通信不会在传输过程中被**破坏**、**复制**、或产生**畸变**

## 资源

&nbsp;&nbsp;&nbsp;&nbsp;Web 服务器是 Web **资源**的宿主，Web 资源是 Web 内容的源头，最简单的 Web 资源就是一些静态文件，但是资源不一定是静态文件，总之，所有类型的内容来源都是**资源**（因特网搜索引擎也是一种资源）

#### 媒体类型

1.  HTTP 会给每种要通过 Web 传输的对象都打上名为 `MIME` 类型的数据格式标签（最初 MIME 是在电子邮箱系统中，HTTP 是后来借鉴了它）
2.  Web 服务器会为所有的 HTTP 对象数据附加一个 MIME 类型（附录 D 提供了一个完整的 MIME 类型列表）

#### URL

1.  服务器资源名被称为**统一资源标识符**（URI），在世界范围内唯一标识并定位信息资源
2.  URI 有两种形式，**统一资源定位符**（URL）和**统一资源名**（URN）`

#### URL

&nbsp;&nbsp;&nbsp;&nbsp;大部分 url 都遵循一种标准格式，这种格式包含三个部分

1.  第一个部分被称为**方案**，说明了访问资源使用的协议类型，通常就是 HTTP 协议（http://）
2.  第二个部分给出了服务器因特网地址，例如 www.baidu.com
3.  其余部分指定了 Web 服务器上某个资源，例如 /aa/bbb.jpg

#### URN（[第二章](./chapter_two.md)详细讨论）

1.  与目前的资源所在地无关，因此可以将资源四处搬移，通过 urn，还可以用同一个名字通过多种网络访问协议来访问资源（主要是进展太慢，被后来的技术给取代了）

## 事务

&nbsp;&nbsp;&nbsp;&nbsp;一个 HTTP 事务由一条**请求命令**和一个**响应结果**组成，这种通信是通过名为 HTTP 报文的格式化**数据块**进行的

#### 方法

&nbsp;&nbsp;&nbsp;&nbsp;HTTP 支持几种不同的请求命令，这些命令被称为 **HTTP 方法**，以下是一些常见的 HTTP 方法

| 方法    | 描述                                                                                                                |
| ------- | ------------------------------------------------------------------------------------------------------------------- |
| GET     | 请求一个指定资源的表示形式. 使用 GET 的请求应该只被用于获取数据                                                     |
| HEAD    | 请求一个与 GET 请求的响应相同的响应，但没有响应体，如果想要检测一个资源是否存在，用 HEAD 方法会更加符合语义         |
| POST    | 用于将实体提交到指定的资源，通常导致状态或服务器上的副作用的更改                                                    |
| PUT     | 与 POST 方法类似，用请求有效载荷替换目标资源的所有当前表示，通常会指定具体的资源存放位置                            |
| PATCH   | 用于对资源应用部分修改，put 方法只允许完全替换文档，而 patch 方法可以修改部分                                       |
| DELETE  | 删除指定资源                                                                                                        |
| OPTIONS | 用于描述目标资源的通信选项，主要用于获取当前服务器所支持的方法，若请求成功，会返回一个 Allow 头部，值是所支持的方法 |
| CONNECT | 会建立一个由目标资源标识的服务器隧道，HTTP/1.1 协议中预留给能够将连接改为隧道方式的代理服务器                       |
| TRACE   | 沿着到目标资源的路径执行一个消息环回测试，回显服务器收到的请求，主要用于测试或诊断                                  |

#### 状态码（[第三章](./chapter_three.md)详细解释了 http 状态码]）

1.  每条 HTTP 响应报文返回时都会携带一个状态码，告知客户端
2.  伴随每个数字状态码，HTTP 还会发送一条解释性的**原因短句**
3.  一些常见的 htpp 状态码

| 状态码 | 描述                                      |
| ------ | ----------------------------------------- |
| 200    | OK。 文档正确返回                         |
| 302    | Redirect（重定向）。 到其他地方去获取资源 |
| 404    | Not Found (没找到)。 无法找到这个资源     |

#### Web 页面可以包含多个对象

&nbsp;&nbsp;&nbsp;&nbsp;一个 Web 页面通常并不是单个资源，而是一组资源的集合

## 报文

&nbsp;&nbsp;&nbsp;&nbsp;[第三章](../chapter_three.md)会深入 http 报文，报文分为**请求报文**和**响应报文**，没有其他类型的报文。报文包含以下三个部分

#### 起始行

&nbsp;&nbsp;&nbsp;&nbsp;报文的第一行就是起始行，在**请求报文中**用来说明要做些什么，在**响应报文中**用来说明出现了什么情况

#### 首部字段

&nbsp;&nbsp;&nbsp;&nbsp;起始行后面有 0 个或多个首部字段，每个字段包含一个名字和一个值，两者之间用 `:` 分隔，首部以一个空行结束

#### 主体

&nbsp;&nbsp;&nbsp;&nbsp;空行之后就是**可选的**报文主体，包含了所有类型的数据，起始行和首部都是文本且结构化的，而主体可以是任意的二进制数据（图片，音视频，软件等）

可以找一个网站，打开 network 看看 demo

## 连接

#### TCP/IP（传输层）
&nbsp;&nbsp;&nbsp;&nbsp;HTTP 是个应用层协议，联网的细节交个了 TCP/IP，TCP 提供了

+ 无差错的数据传输
+ 按序传输（数据会按照发送的顺序到达）
+ 未分段的数据流，可以在任意时刻以任意尺寸
+ http 位于 TCP 上层，TCP 位于 IP 上层

#### 连接、IP 地址、端口号
&nbsp;&nbsp;&nbsp;&nbsp;在使用 HTTP 发送报文之前，需要建立一条 TCP/IP 连接，可以通过 url 获得 ip 地址和端口号，简单的步骤如下：
>> (a) 浏览器从 url 中解析出服务器的主机名<br>
>> (b) 浏览器将主机名换成 ip 地址<br>
>> (c) 浏览器将端口号从 url 中解析出来<br>
>> (d) 浏览器建立一条与服务器的 tcp 连接<br>
>> (e) 浏览器发送一条 http 请求报文<br>
>> (f) 服务器向浏览器回送一条 http 响应报文<br>
>> (g) 关闭连接，浏览器显示文档<br>

我们可以通过 netcat 模拟客户端，他可以很好地操纵基于 UDP 和 TCP 的流量

#### 协议版本

+ **http/0.9**：
&nbsp;&nbsp;&nbsp;&nbsp;只支持 GET 方法，不支持多媒体 MIME 类型等，很快被取代了
+ **http/1.0**：
&nbsp;&nbsp;&nbsp;&nbsp;第一个广泛使用的版本，添加了**版本号**、各种**http 首部**、一些额外的**方法**，以及对多媒体对象的处理
+ **hhttp/1.0+**：
&nbsp;&nbsp;&nbsp;&nbsp;添加了很多新特效，**keep-alive连接**、**虚拟主机支持**、**代理连接**支持
+ **http/1.1**：
&nbsp;&nbsp;&nbsp;&nbsp;校正 HTTP 设计中的结构性缺陷、明确语义、引入重要性能优化，删除不好的特性
+ **http/2.0**：
&nbsp;&nbsp;&nbsp;&nbsp;性能的大幅优化，以及更强大的服务逻辑远程执行框架，详细介绍在[第十章](../two_part/chapter_ten.md)


## web 的结构组件
&nbsp;&nbsp;&nbsp;&nbsp;除了 Web 浏览器和 Web 服务器之外，还有其他一些比较重要的应用程序，下面列出一些比较重要的应用程序

+ **代理**：
&nbsp;&nbsp;&nbsp;&nbsp;位于客户端和服务器之间的 HTTP 中间实体
+ **缓存**：
&nbsp;&nbsp;&nbsp;&nbsp;HTTP 的仓库，使常用页面的副本可以保存在离客户端更近的地方
+ **网关**：
&nbsp;&nbsp;&nbsp;&nbsp;连接其他应用程序的特殊 Web 服务器
+ **隧道**：
&nbsp;&nbsp;&nbsp;&nbsp;对 HTTP 通信报文进行盲转发的特殊代理
+ **Agent 代理**：
&nbsp;&nbsp;&nbsp;&nbsp;发起自动 HTTP 请求的半智能 Web 客户端

#### 代理

+ 代理位于客户端和服务器之间
+ 接收所有客户端的 HTTP 请求，并将这些请求转发给服务器
+ 可能会对请求进行修改之后转发，比如对小学生屏蔽一些成人才能看的内容😁

#### 缓存（[第七章](../two_part/chapter_seven.md)介绍了缓存技术）

+ Web 缓存（Web cache）或代理缓存（proxy cache）是一种特殊的 HTTP 代理服务器
+ HTTP 定义了很多功能，使得缓存更加高效，并规范了文档的新鲜度和缓存内容的隐私性

#### 网关（[第八章](../two_part/chapter_eight.md)将探讨网关）

+ 网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用
+ 通常用于将 HTTP 流量转换成其他的协议
+ 例如接受一个 HTTP 请求然后转换为 FTP 协议去获取文档，然后文档被封装为一条 HTTP 报文，发送给客户端

#### 隧道

+ 隧道（tunnel）是建立起来之后，就会在两条连接之间对原始数据进行盲转发的 HTTP 应用程序
+ HTTP 隧道通常用来在一条或多条 HTTP 连接上转发非 HTTP 数据，转发时不会窥探数据
+ HTTP 隧道的一种常见用途是通过 HTTP 连接承载加密的安全套接字层（SSL）流量，这样 SSL 流量就可以穿过只允许 Web 流量通过的防火墙了

### Agent 代理

+ 用户 Agent 代理是代表用户发起 HTTP 请求的客户端程序
+ 所有发布 Web 请求的应用程序都是 HTTP Agent 代理
+ 例如浏览器、netcat、爬虫等

<br><br>
--------------------------------------------------- 我是分割线 -----------------------------------------
<br><br>

## 总结
**Q: HTTP 是干嘛的啊**<br>
A: HTTP 是数据传输协议（超文本传输协议），沟通客户端与服务器的
<br><br>

**Q: 资源是什么啊**<br>
A: 网络是一切皆资源，除了静态资源，还可以是动态生成的代码，虚拟的接口等，例如在 nodejs 中
<br><br>

**Q: 媒体类型是啥啊**<br>
A: 一种数据类型标记，告诉客户端数据的类型，这样客户端就能知道该怎么处理数据，常见的就是 MIME
<br><br>

**Q: URI、URL、URN是啥啊**<br>
A: URI 能够在网络上确定唯一的一个资源，好比身份证，URL 和 URN 都是它的子集，URL 跟资源在网络上的位置有关，URN 跟资源的名字有关，URN 感觉快废掉了
<br><br>

**Q: 事务是啥啊**<br>
A: 简单来说为**一次 HTTP 连接**的整个过程，不包括 TCP/IP 连接，由请求命令和响应结果组成，中间的数据格式 http 报文。如请求某个 html，某个图片
<br><br>

**Q: 常见的方法有哪些啊**<br>
A: GET、POST、DELETE、PUT、HEAD
<br><br>

**Q: 状态码有啥用啊**<br>
A: 状态码对程序有用，原因短句对人有。nodejs http 模块源码和 express 源码都有对状态码和原因断句的封装
<br><br>

**Q: 简单介绍下报文呗**<br>
A: 报文是 HTTP 协议的一种纯文本数据格式，只用请求报文和响应报文，都是有三个部分，起始行、首部、主体组成。起始行描述报文干了什么，首部描述了传输细节，主体描述具体的传输内容。除了主体可以是任意的二进制数据，其他俩都是结构化的文本类型
<br><br>

**Q: TCP/IP 跟 HTTP 有什么关系**<br>
A: HTTP 是一个应用层协议，而 TCP/IP 是一个传输层，它过滤了每个计算机的差异性，隐藏了相关弱点。HTTP 位于 TCP/IP 上面
<br><br>

**Q: 一次网络请求，经历了哪些过程**<br>
A: [看这就好了](#连接ip-地址端口号)
<br><br>

**Q: HTTP 协议有哪些版本**<br>
A: [看这](#协议版本)
<br><br>

**Q: 介绍下 Web 结构组件**<br>
A: [看这](#web-的结构组件)